# RolandV-1HD-Arduino-TallyLights
A Tally light system for the Roland V-1HD Video switcher using Arduino, MIDI, and DTMF

Intro
I bought this Roland V-1HD during the beginning of the COVID-19 pandemic when many gatherings were going online. I chose this one because it was in stock (many video systems went out of stock in early 2020) and it has a T-bar switcher, a staple of old-school video switching systems like Grass Valley switchers made infamous in Star Wars as the firing mechanism for the Death Star. 

In a multi-camera system its important for the talent to know which camera to look towards, and broadcast cameras have something called a Tally Light, a red light that goes on when that camera is live.  This project set out to use the Roland V-1HD's Midi output to build a Tally Light system.

Arduino
The Arduino UNO is the basic component of the system, easy to program, and having a wide array of hardware addons (called Shields) and software libraries.

Sparkfun MIDI Shield https://www.sparkfun.com/products/12898
The Sparkfun MIDI shield was selected to provide a reliable and testing interface between the V-1HD and an Arduino board. The MIDI Shield comes with a MIDI monitor sofwtare example that lets you monitor the MIDI commands coming from the V-1HD to start to learn how it works. It is also explained in the Roland guide https://rolandus.zendesk.com/hc/en-us/articles/360031884432-V-1HD-How-to-Control-Your-Switcher-Using-MIDI-Commands

DTMF signalling
Since the cameras are typically quite far from the switcher I wanted a reliable way to send commands to them. I considered wirelss conrollers but there is already a lot of Wifi traffic for our video and audio switching systems, and since there are already hdmi and power cables going to the cameras a wired system seemed most reliable, especially if it could use standard XLR mic cables, which are inexpensive and reliable. Initially I tried sending serial commands to teh remote unit but found that to be unreliable in the face of noise, so switched to DTMF signalling. You don't hear DTMF tone very much anymore with cell phones, but they have been the way telephone systems communicated in the latter days of analog telephony, and is still how landline telephones work remember those?) The DTMF generation is done in software using a wave table sythesizer, brilliantly coded by DZL http://blog.dzl.dk/2014/04/26/thesynth-arduino-library-got-upgrade/ and explained clearly by Gadget Reboot https://youtu.be/9OtRh3_pn68 and https://www.patreon.com/gadgetreboot. His description of using the synth to generate DTMF is here: https://youtu.be/Wx6C4k_xxz0

I chose to use the software DTMF generator and a hardware DTMF detector, but it took a while to come to this decision. I tried a hardware DTMF generator but didn't read the spec clearly enough to realize that is could only generate one tone every 500ms, or twice a second, which would add too much latency to the project. The software synth is very fast and has low latency. On the receiving side I tried a number of software solutions but they either didn't hear anything or too too long to identify a tone. I learned that DC bias is important consideration. The low pass filter not only smooths out the PWM pulse-width-modulated output from the Arduino sythesizer, but also has a 10uf capacitor that removes the DC bias, and important aspect for driving an amp and speaker, or for a hardware DTMF decoder. The best DTMF decoder I could find is the Mitel MT8870, which is a chip I worked with in 1985 at Mitel in Kanata, Ontario. This chip has 8 on-chip (analog) bandpass filters and can detect a DTMF tonein as little as 40ms, allowing us to send up to 25 digits per second. In this application speed is not so important, but latency is- how soon after pressing a button on the V-1HD does the Tally Light come on.
